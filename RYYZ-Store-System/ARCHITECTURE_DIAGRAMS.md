# ğŸ¨ AI Chatbot Architecture - Visual Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CUSTOMER INTERACTION                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND (React - Port 5173)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chatbot.jsx                                                    â”‚ â”‚
â”‚  â”‚  â€¢ Floating chat icon (bottom-right)                           â”‚ â”‚
â”‚  â”‚  â€¢ Chat window with messages                                   â”‚ â”‚
â”‚  â”‚  â€¢ Product cards with images                                   â”‚ â”‚
â”‚  â”‚  â€¢ WebSocket connection manager                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    WebSocket (ws://localhost:8001/ws/chatbot/)
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND - WebSocket Server (Django Channels - Port 8001)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  consumers.py - ChatbotConsumer                                â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  1. receive() - Get customer message                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  2. process_with_ai() - Main AI processing              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  3. send() - Send response back                         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                           â”‚                        â”‚
            â”‚                           â”‚                        â”‚
            â–¼                           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KnowledgeBase     â”‚    â”‚  OpenAI API         â”‚    â”‚ Product          â”‚
â”‚ (knowledge_base.pyâ”‚    â”‚  (External)         â”‚    â”‚ Recommender      â”‚
â”‚                   â”‚    â”‚                     â”‚    â”‚ (product_        â”‚
â”‚ â€¢ Store info      â”‚    â”‚ gpt-4o-mini         â”‚    â”‚  recommender.py) â”‚
â”‚ â€¢ Shipping policy â”‚    â”‚                     â”‚    â”‚                  â”‚
â”‚ â€¢ Return policy   â”‚    â”‚ Input: Messages     â”‚    â”‚ â€¢ Extract        â”‚
â”‚ â€¢ FAQs            â”‚    â”‚ Output: AI Response â”‚    â”‚   criteria       â”‚
â”‚ â€¢ Product details â”‚    â”‚                     â”‚    â”‚ â€¢ Search DB      â”‚
â”‚ â€¢ Recommendations â”‚    â”‚ Cost: ~$0.003/call  â”‚    â”‚ â€¢ Return productsâ”‚
â”‚                   â”‚    â”‚                     â”‚    â”‚                  â”‚
â”‚ get_relevant_     â”‚    â”‚                     â”‚    â”‚                  â”‚
â”‚ context()         â”‚    â”‚                     â”‚    â”‚                  â”‚
â”‚ â†“ Returns only    â”‚    â”‚                     â”‚    â”‚                  â”‚
â”‚   relevant sectionsâ”‚   â”‚                     â”‚    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                           â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                            â”‚                                    â”‚
                            â–¼                                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
            â”‚  AI Processing Flow:                â”‚              â”‚
            â”‚                                     â”‚              â”‚
            â”‚  1. Get knowledge context           â”‚              â”‚
            â”‚  2. Build system prompt            â”‚              â”‚
            â”‚  3. Add conversation history       â”‚              â”‚
            â”‚  4. Call OpenAI API                â”‚              â”‚
            â”‚  5. Get AI response                â”‚              â”‚
            â”‚  6. Detect if products needed â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚  7. Return response                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Database (SQLite)                 â”‚
            â”‚                                     â”‚
            â”‚  â€¢ Products table                  â”‚
            â”‚  â€¢ Orders table                    â”‚
            â”‚  â€¢ Users table                     â”‚
            â”‚                                     â”‚
            â”‚  Product fields:                   â”‚
            â”‚  â€¢ id, name, category              â”‚
            â”‚  â€¢ price, stock                    â”‚
            â”‚  â€¢ description                     â”‚
            â”‚  â€¢ image                           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
Customer Message Flow:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customerâ”‚ "I need something for drinking coffee outside"
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend        â”‚ Convert to JSON: {"message": "I need something..."}
â”‚ (Chatbot.jsx)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ WebSocket Send
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend         â”‚ Receive message
â”‚ (consumers.py)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                     â”‚
     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Knowledge   â”‚      â”‚ OpenAI API   â”‚
â”‚Base        â”‚      â”‚              â”‚
â”‚            â”‚      â”‚ Sends:       â”‚
â”‚Returns:    â”‚      â”‚ â€¢ System     â”‚
â”‚"For coffee â”‚â”€â”€â”€â”€â”€â”€â”‚   prompt     â”‚
â”‚outings,    â”‚      â”‚ â€¢ Knowledge  â”‚
â”‚recommend   â”‚      â”‚ â€¢ User msg   â”‚
â”‚casual,     â”‚      â”‚              â”‚
â”‚comfortable"â”‚      â”‚ Returns:     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ "Great! For  â”‚
                    â”‚  coffee      â”‚
                    â”‚  outings, I  â”‚
                    â”‚  recommend..." â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚AI extracts:  â”‚
                    â”‚{             â”‚
                    â”‚ category:    â”‚
                    â”‚  "hoodie",   â”‚
                    â”‚ occasion:    â”‚
                    â”‚  "coffee",   â”‚
                    â”‚ style:       â”‚
                    â”‚  "casual"    â”‚
                    â”‚}             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Product       â”‚
                    â”‚Recommender   â”‚
                    â”‚              â”‚
                    â”‚Searches DB   â”‚
                    â”‚with criteria â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Database      â”‚
                    â”‚              â”‚
                    â”‚Returns:      â”‚
                    â”‚[Product1,    â”‚
                    â”‚ Product2,    â”‚
                    â”‚ ...]         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Response Package:        â”‚
                    â”‚ {                        â”‚
                    â”‚   type: "products",      â”‚
                    â”‚   message: "Great! ...", â”‚
                    â”‚   products: [            â”‚
                    â”‚     {                    â”‚
                    â”‚       name: "Hoodie",    â”‚
                    â”‚       price: 350,        â”‚
                    â”‚       image_url: "...",  â”‚
                    â”‚     },                   â”‚
                    â”‚     ...                  â”‚
                    â”‚   ]                      â”‚
                    â”‚ }                        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ WebSocket Send
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Frontend     â”‚
                    â”‚              â”‚
                    â”‚ Displays:    â”‚
                    â”‚ â€¢ AI Message â”‚
                    â”‚ â€¢ Product    â”‚
                    â”‚   Cards      â”‚
                    â”‚ â€¢ Images     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure & Responsibilities

```
Phase2/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ .env                          âš™ï¸ Configuration (API keys)
â”‚   â”œâ”€â”€ .env.example                  ğŸ“ Template for .env
â”‚   â”œâ”€â”€ test_openai.py               ğŸ§ª Test OpenAI integration
â”‚   â”‚
â”‚   â”œâ”€â”€ chatbot/                      ğŸ¤– CHATBOT MODULE
â”‚   â”‚   â”œâ”€â”€ consumers.py             ğŸ”§ Main chatbot logic
â”‚   â”‚   â”‚   â€¢ ChatbotConsumer class
â”‚   â”‚   â”‚   â€¢ WebSocket handling
â”‚   â”‚   â”‚   â€¢ AI processing
â”‚   â”‚   â”‚   â€¢ Response generation
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ knowledge_base.py        ğŸ“š Store knowledge
â”‚   â”‚   â”‚   â€¢ Store policies
â”‚   â”‚   â”‚   â€¢ FAQs
â”‚   â”‚   â”‚   â€¢ Product info
â”‚   â”‚   â”‚   â€¢ Context extraction
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ product_recommender.py   ğŸ” Product matching
â”‚   â”‚   â”‚   â€¢ Criteria extraction
â”‚   â”‚   â”‚   â€¢ Database queries
â”‚   â”‚   â”‚   â€¢ Product filtering
â”‚   â”‚   â”‚   â€¢ Scoring/ranking
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ product_filter.py        ğŸ—‚ï¸ Basic filtering
â”‚   â”‚   â”‚   â€¢ Legacy filter
â”‚   â”‚   â”‚   â€¢ Still useful for
â”‚   â”‚   â”‚     simple queries
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ routing.py               ğŸ›¤ï¸ WebSocket routes
â”‚   â”‚       â€¢ URL patterns
â”‚   â”‚       â€¢ Consumer mapping
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ settings.py              âš™ï¸ Django settings
â”‚   â”‚   â”‚   â€¢ OpenAI config
â”‚   â”‚   â”‚   â€¢ Channels config
â”‚   â”‚   â”‚   â€¢ Apps registration
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ asgi.py                  ğŸ”Œ ASGI config
â”‚   â”‚       â€¢ WebSocket routing
â”‚   â”‚       â€¢ Protocol handlers
â”‚   â”‚
â”‚   â””â”€â”€ requirements.txt             ğŸ“¦ Python packages
â”‚       â€¢ openai==1.58.1
â”‚       â€¢ python-dotenv==1.0.0
â”‚       â€¢ channels, django, etc.
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ src/
        â””â”€â”€ components/
            â””â”€â”€ Chatbot/
                â”œâ”€â”€ Chatbot.jsx       ğŸ’¬ Chat UI
                â”‚   â€¢ WebSocket client
                â”‚   â€¢ Message display
                â”‚   â€¢ Product cards
                â”‚   â€¢ User input
                â”‚
                â””â”€â”€ Chatbot.css       ğŸ¨ Styling
                    â€¢ Layout
                    â€¢ Animations
                    â€¢ Responsive design
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHATBOT ECOSYSTEM                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚   Customer   â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚         â”‚                                                   â”‚
â”‚         â”œâ”€â”€â”€ Types message                                 â”‚
â”‚         â”œâ”€â”€â”€ Clicks "Send"                                 â”‚
â”‚         â”œâ”€â”€â”€ Clicks "Show Hoodies" button                  â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React Component (Chatbot.jsx)                       â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  State Management:                                   â”‚ â”‚
â”‚  â”‚  â€¢ messages[]       - Chat history                   â”‚ â”‚
â”‚  â”‚  â€¢ isConnected      - WebSocket status               â”‚ â”‚
â”‚  â”‚  â€¢ isTyping         - Bot typing indicator           â”‚ â”‚
â”‚  â”‚  â€¢ inputMessage     - User input                     â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Functions:                                          â”‚ â”‚
â”‚  â”‚  â€¢ connectWebSocket()  - Establish connection        â”‚ â”‚
â”‚  â”‚  â€¢ handleSendMessage() - Send user message           â”‚ â”‚
â”‚  â”‚  â€¢ renderMessage()     - Display messages            â”‚ â”‚
â”‚  â”‚  â€¢ toggleChat()        - Open/close window           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                          â”‚
â”‚                                  â”‚ WebSocket                â”‚
â”‚                                  â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Django Channels (consumers.py)                      â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Lifecycle:                                          â”‚ â”‚
â”‚  â”‚  1. connect()     - Accept connection, send greeting â”‚ â”‚
â”‚  â”‚  2. receive()     - Process incoming messages        â”‚ â”‚
â”‚  â”‚  3. disconnect()  - Clean up                         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Processing:                                         â”‚ â”‚
â”‚  â”‚  â€¢ Parse message                                     â”‚ â”‚
â”‚  â”‚  â€¢ Add to conversation history                       â”‚ â”‚
â”‚  â”‚  â€¢ Call process_with_ai()                            â”‚ â”‚
â”‚  â”‚  â€¢ Format response                                   â”‚ â”‚
â”‚  â”‚  â€¢ Send back to frontend                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                  â”‚                      â”‚
â”‚                  â–¼                  â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  KnowledgeBase    â”‚   â”‚  OpenAI API       â”‚            â”‚
â”‚  â”‚                   â”‚   â”‚                   â”‚            â”‚
â”‚  â”‚  Provides context â”‚   â”‚  Generates        â”‚            â”‚
â”‚  â”‚  based on keywordsâ”‚   â”‚  intelligent      â”‚            â”‚
â”‚  â”‚                   â”‚   â”‚  responses        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                  â”‚                          â”‚
â”‚                                  â–¼                          â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                      â”‚ Product Recommenderâ”‚                â”‚
â”‚                      â”‚                    â”‚                â”‚
â”‚                      â”‚ Finds matching     â”‚                â”‚
â”‚                      â”‚ products from DB   â”‚                â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cost Optimization Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Token Usage Breakdown (Example Conversation)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  WITHOUT OPTIMIZATION:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ System Prompt:     500 tokens                          â”‚â”‚
â”‚  â”‚ Full Knowledge:   4000 tokens  â† Entire knowledge baseâ”‚â”‚
â”‚  â”‚ Conversation:     1000 tokens                          â”‚â”‚
â”‚  â”‚ AI Response:       500 tokens                          â”‚â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚
â”‚  â”‚ TOTAL:            6000 tokens                          â”‚â”‚
â”‚  â”‚ Cost per call:    $0.009                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  WITH OPTIMIZATION (What We Built):                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ System Prompt:     500 tokens                          â”‚â”‚
â”‚  â”‚ Relevant Context:  800 tokens  â† Only relevant sectionsâ”‚â”‚
â”‚  â”‚ Conversation:      500 tokens  â† Last 10 messages only â”‚â”‚
â”‚  â”‚ AI Response:       300 tokens  â† max_tokens limit     â”‚â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚
â”‚  â”‚ TOTAL:            2100 tokens                          â”‚â”‚
â”‚  â”‚ Cost per call:    $0.003                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  ğŸ’° SAVINGS: 65% reduction in cost!                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request-Response Timing

```
Timeline of a Customer Query:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

0ms     â”‚ Customer types: "Show me hoodies"
        â”‚
50ms    â”‚ Frontend: Click "Send" â†’ Send WebSocket message
        â”‚
55ms    â”‚ Backend: Receive message
        â”‚
60ms    â”‚ KnowledgeBase: Extract relevant context (5ms)
        â”‚
100ms   â”‚ OpenAI API: Send request
        â”‚
        â”‚ â³ Waiting for AI response...
        â”‚
800ms   â”‚ OpenAI API: Receive AI-generated response
        â”‚
850ms   â”‚ Product Recommender: Search database (50ms)
        â”‚
900ms   â”‚ Backend: Package response with products
        â”‚
905ms   â”‚ Frontend: Receive WebSocket response
        â”‚
910ms   â”‚ Frontend: Render AI message + product cards
        â”‚
Total: ~910ms (under 1 second!)
```

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Key Security                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  .env file (NOT in git)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚  .gitignore                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ .env        â† Prevents .env from being committed  â”‚ â”‚
â”‚  â”‚ *.pyc                                             â”‚ â”‚
â”‚  â”‚ __pycache__/                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚  python-dotenv                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ load_dotenv()  â† Loads .env variables            â”‚ â”‚
â”‚  â”‚ os.getenv('OPENAI_API_KEY')                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚  settings.py                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OPENAI_API_KEY = os.getenv('OPENAI_API_KEY')     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚  consumers.py                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ client = AsyncOpenAI(api_key=settings.OPENAI_...)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚  OpenAI API (Encrypted HTTPS)                         â”‚
â”‚                                                         â”‚
â”‚  âœ… API key never exposed to frontend                  â”‚
â”‚  âœ… API key never in version control                   â”‚
â”‚  âœ… API key only in backend server                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This visual guide should help you understand exactly how everything connects and works together! ğŸ¨
